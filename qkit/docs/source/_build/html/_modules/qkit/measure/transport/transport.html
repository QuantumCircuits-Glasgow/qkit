<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>qkit.measure.transport.transport &mdash; QKIT 0.3 alpha documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            QKIT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules.html">qkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_notebooks/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Contributing.html">How to contribute</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">QKIT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">qkit.measure.transport.transport</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for qkit.measure.transport.transport</h1><div class="highlight"><pre>
<span></span><span class="c1"># transport.py  measurement class for IV like transport measurements</span>
<span class="c1"># Hannes Rotzinger, hannes.rotzinger@kit.edu 2010</span>
<span class="c1"># Micha Wildermuth, micha.wildermuth@kit.edu 2017</span>

<span class="c1"># This program is free software; you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation; either version 2 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program; if not, write to the Free Software</span>
<span class="c1"># Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>


<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="kn">import</span> <span class="nn">qkit</span>
<span class="kn">from</span> <span class="nn">qkit.storage</span> <span class="kn">import</span> <span class="n">store</span> <span class="k">as</span> <span class="n">hdf</span>
<span class="kn">from</span> <span class="nn">qkit.gui.plot</span> <span class="kn">import</span> <span class="n">plot</span> <span class="k">as</span> <span class="n">qviewkit</span>
<span class="kn">from</span> <span class="nn">qkit.gui.notebook.Progress_Bar</span> <span class="kn">import</span> <span class="n">Progress_Bar</span>
<span class="kn">from</span> <span class="nn">qkit.measure.measurement_class</span> <span class="kn">import</span> <span class="n">Measurement</span> 
<span class="kn">import</span> <span class="nn">qkit.measure.write_additional_files</span> <span class="k">as</span> <span class="nn">waf</span>


<div class="viewcode-block" id="transport"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport">[docs]</a><span class="k">class</span> <span class="nc">transport</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a measurement class to perform transport measurements such as IV-characteristics by means of a current-voltage source meter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">IV_Device</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the class for transport measurement such as IV characteristics.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        IV_Device: qkit-instrument</span>
<span class="sd">            Current-voltage device that provides biasing and sensing.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import qkit</span>
<span class="sd">        QKIT configuration initialized -&gt; available as qkit.cfg[...]</span>
<span class="sd">        &gt;&gt;&gt; qkit.cfg[&#39;run_id&#39;]=&#39;run_number&#39;</span>
<span class="sd">        &gt;&gt;&gt; qkit.cfg[&#39;user&#39;]=&#39;User&#39;</span>
<span class="sd">        &gt;&gt;&gt; qkit.start()</span>
<span class="sd">        Starting QKIT framework ... -&gt; qkit.core.startup</span>
<span class="sd">        Loading module ... S10_logging.py</span>
<span class="sd">        Loading module ... S12_lockfile.py</span>
<span class="sd">        Loading module ... S14_setup_directories.py</span>
<span class="sd">        Loading module ... S20_check_for_updates.py</span>
<span class="sd">        Loading module ... S25_info_service.py</span>
<span class="sd">        Loading module ... S30_qkit_start.py</span>
<span class="sd">        Loading module ... S65_load_RI_service.py</span>
<span class="sd">        Loading module ... S70_load_visa.py</span>
<span class="sd">        Loading module ... S80_load_file_service.py</span>
<span class="sd">        Loading module ... S85_init_measurement.py</span>
<span class="sd">        Loading module ... S98_started.py</span>
<span class="sd">        Loading module ... S99_init_user.py</span>
<span class="sd">        Initialized the file info database (qkit.fid) in 0.000 seconds.</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; IVD = qkit.instruments.create(&#39;IVD&#39;, &#39;Keithley&#39;, address=&#39;TCPIP0::00.00.000.00::INSTR&#39;, reset=True)  # Keithley_2636A</span>
<span class="sd">        &gt;&gt;&gt; from qkit.measure.transport import transport</span>
<span class="sd">        &gt;&gt;&gt; tr = transport.transport(IV_Device=IVD)</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; import qkit.measure.samples_class as sc</span>
<span class="sd">        &gt;&gt;&gt; sample = sc.Sample()</span>
<span class="sd">        &gt;&gt;&gt; sample.name = &#39;sample_name&#39;</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; tr.set_filename(filename=&#39;filename&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tr.set_expname(expname=&#39;expname&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tr.set_comment(comment=&#39;comment&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tr.set_sample(sample)</span>
<span class="sd">        &gt;&gt;&gt; tr.set_dVdI(True)</span>
<span class="sd">        &gt;&gt;&gt; tr.sweep.reset_sweeps()</span>
<span class="sd">        &gt;&gt;&gt; tr.add_sweep_4quadrants(start=0e-9, stop=100e-9, step=100e-12, offset=0e-12)</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; tr.measure_XD()</span>
<span class="sd">        Measurement complete: d:\\data\XXXXXX_XD_sample_name\XXXXXX_XD_sample_name.h5</span>
<span class="sd">        Plots saved in d:\\data\XXXXXX_XD_sample_name\images</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_IVD</span> <span class="o">=</span> <span class="n">IV_Device</span>
        <span class="c1"># measurement object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span> <span class="o">=</span> <span class="n">Measurement</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">measurement_type</span> <span class="o">=</span> <span class="s1">&#39;transport&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_web_visible</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expname</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_comment</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># measurement services</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_qviewkit</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_qvk_process</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># qviewkit process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_comment</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="c1"># measurement setting default values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep</span><span class="p">()</span>  <span class="c1"># calls sweep subclass</span>
        <span class="c1"># numerical derivation dV/dI (differential resistance)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dVdI</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># adds numerical derivation dV/dI as data series, views, ...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_numder_func</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">savgol_filter</span>  <span class="c1"># function to calculate numerical derivative (default: Savitzky-Golay filter)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_numder_args</span> <span class="o">=</span> <span class="p">()</span>  <span class="c1"># arguments for derivation function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_numder_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;window_length&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;polyorder&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;deriv&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>  <span class="c1"># keyword arguments for derivation function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_average</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># trace averaging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_xy</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># x and y data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_y</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># xy, 2D &amp; 3D scan variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_log_function</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_dt</span> <span class="o">=</span> <span class="mf">2e-3</span>  <span class="c1"># in s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_coordname</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_set_obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_unit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tdy</span> <span class="o">=</span> <span class="mf">2e-3</span>  <span class="c1"># in s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_vec</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_coordname</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_set_obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_unit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_landscape</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_func</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_unit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_kwargs</span> <span class="o">=</span> <span class="kc">None</span>
    
<div class="viewcode-block" id="transport.set_sample"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.set_sample">[docs]</a>    <span class="k">def</span> <span class="nf">set_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds sample object (e.g. with sample properties, measurement comments) to measurement object.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sample: qkit.measure.sample_class.Sample()</span>
<span class="sd">            Sample object to store information about the sample.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import qkit.measure.samples_class as sc</span>
<span class="sd">        &gt;&gt;&gt; sample = sc.Sample()</span>
<span class="sd">        &gt;&gt;&gt; sample.name = &#39;sample_name&#39;</span>
<span class="sd">        &gt;&gt;&gt; tr.set_sample(sample)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.add_sweep_4quadrants"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.add_sweep_4quadrants">[docs]</a>    <span class="k">def</span> <span class="nf">add_sweep_4quadrants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sleep</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a four quadrants sweep series with the pattern </span>
<span class="sd">            0th: (+&lt;start&gt; --&gt; +&lt;stop&gt;,  &lt;step&gt;) + &lt;offset&gt;</span>
<span class="sd">            1st: (+&lt;stop&gt;  --&gt; +&lt;start&gt;, &lt;step&gt;) + &lt;offset&gt;</span>
<span class="sd">            2nd: (+&lt;start&gt; --&gt; -&lt;stop&gt;,  &lt;step&gt;) + &lt;offset&gt;</span>
<span class="sd">            3rd: (-&lt;stop&gt;  --&gt; +&lt;start&gt;, &lt;step&gt;) + &lt;offset&gt;</span>
<span class="sd">            time.sleep(&lt;sleep&gt;)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start: float</span>
<span class="sd">            Start value of sweep.</span>
<span class="sd">        stop: float</span>
<span class="sd">            Stop value of sweep.</span>
<span class="sd">        step: float</span>
<span class="sd">            Step value of sweep.</span>
<span class="sd">        offset: float, optional</span>
<span class="sd">            Offset value by which &lt;start&gt; and &lt;stop&gt; are shifted. Default is 0.</span>
<span class="sd">        sleep: float</span>
<span class="sd">            Sleep time after whole sweep. Default is 0.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">add_sweep</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">stop</span><span class="o">=+</span><span class="n">stop</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">sleep</span><span class="o">=</span><span class="n">sleep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">add_sweep</span><span class="p">(</span><span class="n">start</span><span class="o">=+</span><span class="n">stop</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">start</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">sleep</span><span class="o">=</span><span class="n">sleep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">add_sweep</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">stop</span><span class="o">=-</span><span class="n">stop</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">sleep</span><span class="o">=</span><span class="n">sleep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">add_sweep</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="n">stop</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">start</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">sleep</span><span class="o">=</span><span class="n">sleep</span><span class="p">)</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.add_sweep_halfswing"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.add_sweep_halfswing">[docs]</a>    <span class="k">def</span> <span class="nf">add_sweep_halfswing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sleep</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a halfswing sweep series with the pattern </span>
<span class="sd">            0th: (+&lt;amplitude&gt; --&gt; -&lt;amplitude, &lt;step&gt;) + &lt;offset&gt;</span>
<span class="sd">            1st: (-&lt;amplitude&gt; --&gt; +&lt;amplitude, &lt;step&gt;) + &lt;offset&gt;</span>
<span class="sd">            time.sleep(&lt;sleep&gt;)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        amplitude: float</span>
<span class="sd">            Amplitude value of sweep.</span>
<span class="sd">        step: float</span>
<span class="sd">            Step value of sweep.</span>
<span class="sd">        offset: float</span>
<span class="sd">            Offset value by which &lt;start&gt; and &lt;stop&gt; are shifted. Default is 0.</span>
<span class="sd">        sleep: float</span>
<span class="sd">            Sleep time after whole sweep. Default is 0.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">add_sweep</span><span class="p">(</span><span class="n">start</span><span class="o">=+</span><span class="n">amplitude</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">stop</span><span class="o">=-</span><span class="n">amplitude</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">sleep</span><span class="o">=</span><span class="n">sleep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">add_sweep</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="n">amplitude</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">stop</span><span class="o">=+</span><span class="n">amplitude</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">sleep</span><span class="o">=</span><span class="n">sleep</span><span class="p">)</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.set_dVdI"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.set_dVdI">[docs]</a>    <span class="k">def</span> <span class="nf">set_dVdI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the internal dVdI parameter, to decide weather the differential resistance (dV/dI) is calculated or not.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        status: bool</span>
<span class="sd">            Status if numerical derivative is calculated.</span>
<span class="sd">        func: function</span>
<span class="sd">            Function to calculate numerical derivative, e.g. scipy.signal.savgol_filter (default), numpy.gradient, ...</span>
<span class="sd">        *args: array_likes, optional</span>
<span class="sd">            Arguments for derivation function.</span>
<span class="sd">        **kwargs: dictionary_likes, optional</span>
<span class="sd">            Keyword arguments for derivation function.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Savitzky-Golay filter</span>
<span class="sd">        &gt;&gt;&gt; tr.set_dVdI(True, func=signal.savgol_filter, window_length=15, polyorder=3, deriv=1)</span>
<span class="sd">        </span>
<span class="sd">        Gradient as difference quotient</span>
<span class="sd">        &gt;&gt;&gt; tr.set_dVdI(True, func=np.gradient)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dVdI</span> <span class="o">=</span> <span class="n">status</span>
        <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_numder_func</span> <span class="o">=</span> <span class="n">func</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_numder_args</span> <span class="o">=</span> <span class="n">args</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_numder_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.get_dVdI"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.get_dVdI">[docs]</a>    <span class="k">def</span> <span class="nf">get_dVdI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the internal dVdI parameter, to decide weather the differential resistance (dV/dI) is calculated or not.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status: bool</span>
<span class="sd">            Status if numerical derivative is calculated.</span>
<span class="sd">        func: function</span>
<span class="sd">            Function to calculate numerical derivative, e.g. scipy.signal.savgol_filter (default), numpy.gradient, ...</span>
<span class="sd">        *args: array_likes</span>
<span class="sd">            Arguments for derivation function.</span>
<span class="sd">        **kwargs: dictionary_likes</span>
<span class="sd">            Keyword arguments for derivation function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dVdI</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_numder_func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_numder_args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_numder_kwargs</span></div>
    
    <span class="k">def</span> <span class="nf">_numerical_derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates numerical derivative dy/dx by means of set function &lt;self._numder_func&gt;, arguments &lt;self._numder_args&gt; and keyword arguments &lt;self._numder_kwargs&gt;.</span>
<span class="sd">    </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x: array_likes</span>
<span class="sd">            An N-dimensional array containing x-values for numerical derivative.</span>
<span class="sd">        y: array_likes</span>
<span class="sd">            An N-dimensional array containing y-values for numerical derivative.</span>
<span class="sd">    </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dydx: numpy.array</span>
<span class="sd">            An N-dimensional array containing numerical derivative dy/dx.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: catch error, if len(dataset) &lt; window_length in case of SavGol filter</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_numder_func</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_numder_args</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_numder_kwargs</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_numder_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_numder_args</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_numder_kwargs</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    
<div class="viewcode-block" id="transport.set_x_dt"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.set_x_dt">[docs]</a>    <span class="k">def</span> <span class="nf">set_x_dt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_dt</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets sleep time between x-iterations in 2D and 3D scans.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x_dt: float</span>
<span class="sd">            The sleep time between x-iterations.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_dt</span> <span class="o">=</span> <span class="n">x_dt</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.get_x_dt"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.get_x_dt">[docs]</a>    <span class="k">def</span> <span class="nf">get_x_dt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets sleep time between x-iterations in 2D and 3D scans.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        x_dt: float</span>
<span class="sd">            The sleep time between x-iterations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_dt</span></div>
    
<div class="viewcode-block" id="transport.set_x_parameters"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.set_x_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_x_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_vec</span><span class="p">,</span> <span class="n">x_coordname</span><span class="p">,</span> <span class="n">x_set_obj</span><span class="p">,</span> <span class="n">x_unit</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x_dt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets x-parameters for 2D and 3D scan.</span>
<span class="sd">        In a 3D measurement, the x-parameters will be the &quot;outer&quot; sweep meaning for every x value all y values are swept and for each (x,y) value the bias is swept according to the set sweep parameters.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x_vec: array_likes</span>
<span class="sd">            An N-dimensional array that contains the sweep values.</span>
<span class="sd">        x_coordname: string</span>
<span class="sd">            The coordinate name to be created as data series in the .h5 file.</span>
<span class="sd">        x_set_obj: obj</span>
<span class="sd">            An callable object to execute with x_vec-values.</span>
<span class="sd">        x_unit: string, optional</span>
<span class="sd">            The unit name to be used in data series in the .h5 file.</span>
<span class="sd">        x_dt: float, optional</span>
<span class="sd">            The sleep time between x-iterations.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># x-vec</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">x_vec</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_vec</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)(</span><span class="s1">&#39;</span><span class="si">{!s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as x-vector&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">x_vec</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as x-vector: iterable object needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">x_vec</span><span class="p">))</span>
        <span class="c1"># x-coordname</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x_coordname</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x_coordname</span> <span class="o">=</span> <span class="n">x_coordname</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as x-coordname: string needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">x_coordname</span><span class="p">))</span>
        <span class="c1"># x-set-object</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">x_set_obj</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x_set_obj</span> <span class="o">=</span> <span class="n">x_set_obj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as x-set-object: callable object needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">x_set_obj</span><span class="p">))</span>
        <span class="c1"># x-unit</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x_unit</span> <span class="o">=</span> <span class="n">x_unit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as x-unit: string needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">x_unit</span><span class="p">))</span>
        <span class="c1"># x dt</span>
        <span class="k">if</span> <span class="n">x_dt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x_dt</span> <span class="o">=</span> <span class="n">x_dt</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_landscape</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lsc_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lsc_func</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span><span class="p">),</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_lsc_args</span><span class="p">)</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.set_tdy"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.set_tdy">[docs]</a>    <span class="k">def</span> <span class="nf">set_tdy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_dt</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets sleep time between y-iterations in 3D scans.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x_dt: float</span>
<span class="sd">            The sleep time between y-iterations.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tdy</span> <span class="o">=</span> <span class="n">x_dt</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.get_tdy"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.get_tdy">[docs]</a>    <span class="k">def</span> <span class="nf">get_tdy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets sleep time between y-iterations in 3D scans.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        x_dt: float</span>
<span class="sd">            The sleep time between y-iterations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tdy</span></div>
    
<div class="viewcode-block" id="transport.set_y_parameters"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.set_y_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_y_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_vec</span><span class="p">,</span> <span class="n">y_coordname</span><span class="p">,</span> <span class="n">y_set_obj</span><span class="p">,</span> <span class="n">y_unit</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">y_dt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets x-parameters for 3D scan, where y-parameters will be the &quot;inner&quot; sweep meaning for every x value all y values are swept and for each (x,y) value the bias is swept according to the set sweep parameters.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y_vec: array_likes</span>
<span class="sd">            An N-dimensional array that contains the sweep values.</span>
<span class="sd">        y_coordname: string</span>
<span class="sd">            The coordinate name to be created as data series in the .h5 file.</span>
<span class="sd">        y_set_obj: obj</span>
<span class="sd">            An callable object to execute with y_vec-values.</span>
<span class="sd">        y_unit: string, optional</span>
<span class="sd">            The unit name to be used in data series in the .h5 file.</span>
<span class="sd">        y_dt: float, optional</span>
<span class="sd">            The sleep time between y-iterations.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># y-vec</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">y_vec</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_y_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_vec</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)(</span><span class="s1">&#39;</span><span class="si">{!s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as y-vector&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">y_vec</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as y-vector: iterable object needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">y_vec</span><span class="p">))</span>
        <span class="c1"># y-coordname</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">y_coordname</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_coordname</span> <span class="o">=</span> <span class="n">y_coordname</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as y-coordname: string needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">y_coordname</span><span class="p">))</span>
        <span class="c1"># y-set-object</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">y_set_obj</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_set_obj</span> <span class="o">=</span> <span class="n">y_set_obj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as y-set-object: callable object needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">y_set_obj</span><span class="p">))</span>
        <span class="c1"># y-unit</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">y_unit</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_unit</span> <span class="o">=</span> <span class="n">y_unit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as y-unit: string needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">y_unit</span><span class="p">))</span>
        <span class="c1"># y dt</span>
        <span class="k">if</span> <span class="n">y_dt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_dt</span> <span class="o">=</span> <span class="n">y_dt</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.set_landscape"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.set_landscape">[docs]</a>    <span class="k">def</span> <span class="nf">set_landscape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">mirror</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets parameters for landscapes scans in case of 2D and 3D scans to fasten up the measurement.</span>
<span class="sd">        The values of the given envelop function limit the sweep bounds for each x-value of 2D or 3D scans. The overall sweep bounds can merely be decreased, so that only envelop values &lt;= sweep bounds affect them.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func: function</span>
<span class="sd">            An envelop function that limits bias values.</span>
<span class="sd">        args: tuple</span>
<span class="sd">            The arguments for the envelop function.</span>
<span class="sd">        mirror: bool, optional</span>
<span class="sd">            This determines if the envelop function is mirrored at the x-axis. Default is True</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; tr.add_sweep_halfswing(1e-6, 10e-9)</span>
<span class="sd">        &gt;&gt;&gt; def x_function(i):</span>
<span class="sd">                set_x_value(i)</span>
<span class="sd">                return</span>
<span class="sd">        &gt;&gt;&gt; tr.set_x_parameters(x_vec = np.linspace(-10, 10, 21),</span>
<span class="sd">                                x_coordname = &#39;x_name&#39;,</span>
<span class="sd">                                x_set_obj = x_function,</span>
<span class="sd">                                x_unit = &#39;x_unit&#39;)</span>
<span class="sd">        &gt;&gt;&gt; def lsc_func(x, a0, a1, x0):</span>
<span class="sd">                y = np.ones(shape = len(x)) * a1</span>
<span class="sd">                y[np.abs(x) &gt; x0] = a0</span>
<span class="sd">                return y</span>
<span class="sd">        &gt;&gt;&gt; tr.set_landscape(lsc_func, (500e-9, 1e-6, 5))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: possibility for landscape scans in both x and y direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_landscape</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lsc_func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lsc_args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lsc_vec</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lsc_mirror</span> <span class="o">=</span> <span class="n">mirror</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.reset_landscape"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.reset_landscape">[docs]</a>    <span class="k">def</span> <span class="nf">reset_landscape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_landscape</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lsc_vec</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lsc_mirror</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.set_xy_parameters"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.set_xy_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_xy_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_name</span><span class="p">,</span> <span class="n">x_func</span><span class="p">,</span> <span class="n">x_vec</span><span class="p">,</span> <span class="n">x_unit</span><span class="p">,</span> <span class="n">y_name</span><span class="p">,</span> <span class="n">y_func</span><span class="p">,</span> <span class="n">y_unit</span><span class="p">,</span> <span class="n">x_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">y_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">x_dt</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set x- and y-parameters for measure_xy(), where y-parameters can be a list in order to record various quantities.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x_name: str</span>
<span class="sd">            The name of the x-parameter to be created as data series in the .h5 file.</span>
<span class="sd">        x_func: function</span>
<span class="sd">            A function that returns x-values.</span>
<span class="sd">        x_vec: array_likes of floats</span>
<span class="sd">            An array of x-values at which data should be taken.</span>
<span class="sd">        x_unit: str</span>
<span class="sd">            The unit of the x-parameter to be used in data series in the .h5 file.</span>
<span class="sd">        x_kwargs: dict</span>
<span class="sd">            Keyword arguments forwarded to the x-function &lt;x_func&gt;.</span>
<span class="sd">        y_name: array_likes of strings</span>
<span class="sd">            Names of y-parameters to be created as data series in the .h5 file.</span>
<span class="sd">        y_func: function</span>
<span class="sd">            A function that returns y-values.</span>
<span class="sd">        y_unit: array_likes of strings</span>
<span class="sd">            Units of y-parameters to be used in data series in the .h5 file.</span>
<span class="sd">        y_kwargs: dict</span>
<span class="sd">            Keyword arguments forwarded to the y-function &lt;y_func&gt;.</span>
<span class="sd">        x_dt: float, optional</span>
<span class="sd">            The sleep time between queries of x-values. Default is 1e-3.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># x-name</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x_name</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x_name</span> <span class="o">=</span> <span class="n">x_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as x-name: string needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">x_name</span><span class="p">))</span>
        <span class="c1"># x-func</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">x_func</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x_func</span> <span class="o">=</span> <span class="n">x_func</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as x-function: callable object needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">x_func</span><span class="p">))</span>
        <span class="c1"># x-vec</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">x_vec</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span> <span class="o">=</span> <span class="n">x_vec</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as x-vector: iterable object needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">x_vec</span><span class="p">))</span>
        <span class="c1"># x-unit</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x_unit</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x_unit</span> <span class="o">=</span> <span class="n">x_unit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as x-unit: string needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">x_unit</span><span class="p">))</span>
        <span class="c1"># x-kwargs</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x_kwargs</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x_kwargs</span> <span class="o">=</span> <span class="n">x_kwargs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as x-kwargs: dict needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">x_kwargs</span><span class="p">))</span>
        <span class="c1"># y-name</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">y_name</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">y_name</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">y_name</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as y-name: string needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_name</span> <span class="o">=</span> <span class="n">y_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as y-name: string of iterable object of strings needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">y_name</span><span class="p">))</span>
        <span class="c1"># y-func</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">y_func</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_func</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_func</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">y_func</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">y_func</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as y-function: callable object needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">func</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_func</span> <span class="o">=</span> <span class="n">y_func</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as y-function: callable object of iterable object of callable objects needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">y_func</span><span class="p">))</span>
        <span class="c1"># y-unit</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">y_unit</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_unit</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_unit</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">y_unit</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">y_unit</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as y-unit: string needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">unit</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_unit</span> <span class="o">=</span> <span class="n">y_unit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as y-unit: string of iterable object of strings needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">y_unit</span><span class="p">))</span>
        <span class="c1"># y-kwargs</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">y_kwargs</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_kwargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_kwargs</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">y_kwargs</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="n">y_kwargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as y-kwargs: dict needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_kwargs</span> <span class="o">=</span> <span class="n">y_kwargs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as y-kwargs: dict of iterable object of dicts needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">y_kwargs</span><span class="p">))</span>
        <span class="c1"># x-dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_dt</span> <span class="o">=</span> <span class="n">x_dt</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.set_log_function"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.set_log_function">[docs]</a>    <span class="k">def</span> <span class="nf">set_log_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves desired values obtained by a function &lt;func&gt; in the .h5-file as a value vector with name &lt;name&gt;, unit &lt;unit&gt; and in data format &lt;f&gt;.</span>
<span class="sd">        The function (object) can be passed to the measurement loop which is executed before every x iteration</span>
<span class="sd">        but after executing the x_object setter in 2D measurements and before every line (but after setting </span>
<span class="sd">        the x value) in 3D measurements.</span>
<span class="sd">        The return value of the function of type float or similar is stored in a value vector in the h5 file.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func: array_likes of callable objects</span>
<span class="sd">            A callable object that returns the value to be saved.</span>
<span class="sd">        name: array_likes of strings</span>
<span class="sd">            Names of logging parameter appearing in h5 file. Default is &#39;log_param&#39;.</span>
<span class="sd">        unit: array_likes of strings</span>
<span class="sd">            Units of logging parameter. Default is &#39;&#39;.</span>
<span class="sd">        dtype: array_likes of dtypes</span>
<span class="sd">            h5 data type to be used in the data file. Default is &#39;f&#39; (float64).</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: dtype = float instead of &#39;f&#39;</span>
        <span class="c1"># log-function</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="n">func</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">fun</span> <span class="ow">in</span> <span class="n">func</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as y-function: callable object needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">fun</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as log-function: callable object of iterable object of callable objects needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">func</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_function</span> <span class="o">=</span> <span class="n">func</span>
        <span class="c1"># log-name</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;log_param&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">_name</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as log-name: string needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">_name</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as log-name: string of iterable object of strings needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c1"># log-unit</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;log_unit&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="p">[</span><span class="n">unit</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">unit</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">_unit</span> <span class="ow">in</span> <span class="n">unit</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">_unit</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as log-unit: string needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">_unit</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as log-unit: string of iterable object of strings needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">unit</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_unit</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="c1"># log-dtype</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="p">[</span><span class="n">dtype</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">_dtype</span> <span class="ow">in</span> <span class="n">dtype</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">_dtype</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as log-dtype: string needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">_dtype</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: Cannot set </span><span class="si">{!s}</span><span class="s1"> as log-dtype: string of iterable object of strings needed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">dtype</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.get_log_function"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.get_log_function">[docs]</a>    <span class="k">def</span> <span class="nf">get_log_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the current log_function settings.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        func: array_likes of callable objects</span>
<span class="sd">            A callable object that returns the value to be saved.</span>
<span class="sd">        name: array_likes of strings</span>
<span class="sd">            Names of logging parameter appearing in h5 file. Default is &#39;log_param&#39;.</span>
<span class="sd">        unit: array_likes of strings</span>
<span class="sd">            Units of logging parameter. Default is &#39;&#39;.</span>
<span class="sd">        dtype: array_likes of dtypes</span>
<span class="sd">            h5 data type to be used in the data file. Default is float (float64).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_function</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_dtype</span></div>
    
<div class="viewcode-block" id="transport.reset_log_function"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.reset_log_function">[docs]</a>    <span class="k">def</span> <span class="nf">reset_log_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets all log_function settings.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_function</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_name</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_unit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_dtype</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_log</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="transport.set_fit_IV"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.set_fit_IV">[docs]</a>    <span class="k">def</span> <span class="nf">set_fit_IV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets fit-parameters for an in situ IV fit.</span>
<span class="sd">        This function is called for each trace with ints kexword arguments</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func: obj</span>
<span class="sd">            An callable object to execute for each trace.</span>
<span class="sd">        name: string</span>
<span class="sd">            The coordinate name to be created as data series in the .h5 file.</span>
<span class="sd">        unit: string, optional</span>
<span class="sd">            The unit name to be used in data series in the .h5 file.</span>
<span class="sd">        **kwargs: dictionary_likes, optional</span>
<span class="sd">            Keyword arguments for fit function.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from qkit.analysis.IV_curve import IV_curve as IVC</span>
<span class="sd">        &gt;&gt;&gt; ivc = IVC()</span>

<span class="sd">        Ic fit via threshold voltage</span>
<span class="sd">        &gt;&gt;&gt; tr.set_fit_IV(func=ivc.get_Ic_threshold, name=&#39;I_c&#39;, unit=&#39;A&#39;, offset=0)</span>

<span class="sd">        Ic fit via peaks in the numerical derivative dV/dI</span>
<span class="sd">        &gt;&gt;&gt; tr.set_fit_IV(func=ivc.get_Ic_deriv, name=&#39;I_c&#39;, unit=&#39;A&#39;, prominence=10)</span>

<span class="sd">        Ic fit via peaks in the smoothed derivation in the frequency domain</span>
<span class="sd">        &gt;&gt;&gt; tr.set_fit_IV(func=ivc.get_Ic_dft, name=&#39;I_c&#39;, unit=&#39;A&#39;, prominence=1e-2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_unit</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span></div>

<div class="viewcode-block" id="transport.reset_fit_IV"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.reset_fit_IV">[docs]</a>    <span class="k">def</span> <span class="nf">reset_fit_IV</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets all fit_function settings.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_func</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_unit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_kwargs</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="transport.set_filename"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.set_filename">[docs]</a>    <span class="k">def</span> <span class="nf">set_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets filename of current measurement to &lt;filename&gt;.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: str</span>
<span class="sd">            The file name used as suffix of uuid.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.get_filename"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.get_filename">[docs]</a>    <span class="k">def</span> <span class="nf">get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets filename of current measurement.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        filename: str</span>
<span class="sd">            The file name used as suffix of uuid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span></div>
    
<div class="viewcode-block" id="transport.reset_filename"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.reset_filename">[docs]</a>    <span class="k">def</span> <span class="nf">reset_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets filename of current measurement to None.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.set_expname"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.set_expname">[docs]</a>    <span class="k">def</span> <span class="nf">set_expname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets experiment name of current measurement to &lt;expname&gt;.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expname: str</span>
<span class="sd">            The experiment name used as suffix of uuid and &lt;filename&gt;.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expname</span> <span class="o">=</span> <span class="n">expname</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.get_expname"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.get_expname">[docs]</a>    <span class="k">def</span> <span class="nf">get_expname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets experiment name of current measurement</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        expname: str</span>
<span class="sd">            The experiment name used as suffix of uuid and &lt;filename&gt;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expname</span></div>
    
<div class="viewcode-block" id="transport.reset_expname"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.reset_expname">[docs]</a>    <span class="k">def</span> <span class="nf">reset_expname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets experiment name of current measurement to None.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expname</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.set_comment"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.set_comment">[docs]</a>    <span class="k">def</span> <span class="nf">set_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comment</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets comment that is added to the .h5 file to &lt;comment&gt;</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        comment: str</span>
<span class="sd">            The comment added to data in .h5 file.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_comment</span> <span class="o">=</span> <span class="n">comment</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.get_comment"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.get_comment">[docs]</a>    <span class="k">def</span> <span class="nf">get_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets comment that is added to the .h5 file</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        comment: str</span>
<span class="sd">            The comment added to data in .h5 file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comment</span></div>
    
<div class="viewcode-block" id="transport.reset_comment"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.reset_comment">[docs]</a>    <span class="k">def</span> <span class="nf">reset_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets comment that is added to the .h5 file to None.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_comment</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.set_average"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.set_average">[docs]</a>    <span class="k">def</span> <span class="nf">set_average</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">avg</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets trace average parameter.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        avg: int</span>
<span class="sd">            Number of averages of whole traces. Must be None (off) or natural numbers.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_average</span> <span class="o">=</span> <span class="n">avg</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.get_average"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.get_average">[docs]</a>    <span class="k">def</span> <span class="nf">get_average</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets trace average parameter.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        avg: int</span>
<span class="sd">            Number of averages of whole traces. Is None (off) or a natural number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_average</span></div>
    
<div class="viewcode-block" id="transport.set_view_xy"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.set_view_xy">[docs]</a>    <span class="k">def</span> <span class="nf">set_view_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets views that combine different data series of xy-measurement.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        view: bool or array_likes of integers</span>
<span class="sd">            Parameter that determines if additional views of different y-parameters are added. Must be boolean or an array containing tuples of two natural numbers, where y1 is used x-axis and y2 as y-axis.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_xy</span> <span class="o">=</span> <span class="n">view</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.get_view_xy"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.get_view_xy">[docs]</a>    <span class="k">def</span> <span class="nf">get_view_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets views that combine different data series of xy-measurement.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        view: bool or array_likes of integers</span>
<span class="sd">            Parameter that determines if additional views of different y-parameters are added. Is boolean or an array containing tuples of two natural numbers, where y1 is used x-axis and y2 as y-axis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view_xy</span></div>
    
<div class="viewcode-block" id="transport.measure_xy"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.measure_xy">[docs]</a>    <span class="k">def</span> <span class="nf">measure_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Measures single data points, e.g. current or voltage and iterating all parameters x_vec, e.g. time.</span>
<span class="sd">        Every single data point is taken with the current IV Device settings.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; measurement object &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">measurement_func</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; measurement &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measure</span><span class="p">()</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.measure_1D"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.measure_1D">[docs]</a>    <span class="k">def</span> <span class="nf">measure_1D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Measures a 1 dimensional set of IV curves while sweeping the bias according to the set sweep parameters. </span>
<span class="sd">        Every single data point is taken with the current IV Device settings.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">=</span> <span class="mi">1</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; measurement object &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">measurement_func</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; measurement &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measure</span><span class="p">()</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.measure_2D"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.measure_2D">[docs]</a>    <span class="k">def</span> <span class="nf">measure_2D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Measures a 2 dimensional set of IV curves while sweeping the bias according to the set sweep parameters and iterating all parameters x_vec in x_obj. </span>
<span class="sd">        Every single data point is taken with the current IV Device settings.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_set_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: axes parameters not properly set&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: axes parameters not properly set&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">=</span> <span class="mi">2</span>        
<span class="w">        </span><span class="sd">&#39;&#39;&#39; measurement object &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">measurement_func</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; measurement &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measure</span><span class="p">()</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.measure_3D"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.measure_3D">[docs]</a>    <span class="k">def</span> <span class="nf">measure_3D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Measures a 3 dimensional set of IV curves while sweeping the bias according to the set sweep parameters and iterating all parameters x_vec in x_obj and all parameters y_vec in y_obj. The sweep over y_obj is the inner loop, for every value x_vec[i] all values y_vec are measured.</span>
<span class="sd">        Every single data point is taken with the current IV Device settings.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_set_obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_set_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: axes parameters not properly set&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">: axes parameters not properly set&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">=</span> <span class="mi">3</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; measurement object &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">measurement_func</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; measurement &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measure</span><span class="p">()</span>
        <span class="k">return</span></div>
    
    <span class="k">def</span> <span class="nf">_measure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates output files, measures according to IVD and sweep settings, stores data and shows them in the qviewkit</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">_pass</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot; dummy function that just passes, used for x, y iteration in case of 1D and 2D scan &quot;&quot;&quot;</span>
            <span class="k">pass</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; axis labels &#39;&#39;&#39;</span>
        <span class="n">_axis</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_name</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                 <span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;voltage&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                 <span class="mi">2</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_coordname</span><span class="p">,</span> <span class="s1">&#39;current&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>  <span class="c1"># or self._IV_modes[self._bias] for y</span>
                 <span class="mi">3</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_coordname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_coordname</span><span class="p">,</span> <span class="s1">&#39;current&#39;</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">x_axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">y_axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">z_axis</span> <span class="o">=</span> <span class="n">_axis</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span><span class="p">]</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; prepare IV device &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_measurement_IVD</span><span class="p">()</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; prepare data storage &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_measurement_file</span><span class="p">()</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; prepare progress bar &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_progress_bar</span><span class="p">()</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; opens qviewkit to plot measurement &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_qviewkit</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;views/IV&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_name</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_nos</span><span class="p">()):</span>
                        <span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;analysis/</span><span class="si">{:s}</span><span class="s1">_</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_name</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_nos</span><span class="p">()):</span>
                        <span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">_</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_IV_modes</span><span class="p">[</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bias</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">i</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_qvk_process</span> <span class="o">=</span> <span class="n">qviewkit</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">get_filepath</span><span class="p">(),</span> <span class="n">datasets</span><span class="o">=</span><span class="n">datasets</span><span class="p">)</span>  <span class="c1"># opens IV-view by default</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; measurement &#39;&#39;&#39;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">qkit</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># single data points</span>
                <span class="k">for</span> <span class="n">x_val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x_val</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_x_func</span><span class="p">(</span><span class="n">x_val</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_kwargs</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">lst</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_kwargs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_y</span><span class="p">):</span>
                        <span class="n">lst</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                    <span class="c1"># iterate progress bar</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_pb</span><span class="o">.</span><span class="n">iterate</span><span class="p">()</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_dt</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>  <span class="c1"># IV curve</span>
                <span class="n">_rst_log_hdf_appnd</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># variable to save points of log-function in 2D-matrix</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rst_fit_hdf_appnd</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="bp">self</span><span class="o">.</span><span class="n">ix</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_func</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([(</span><span class="kc">None</span><span class="p">,</span> <span class="n">_pass</span><span class="p">)]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_set_obj</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span><span class="p">]):</span>  <span class="c1"># loop: x_obj with parameters from x_vec if 2D or 3D else pass(None)</span>
                    <span class="n">x_func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_dt</span><span class="p">)</span>
                    <span class="k">for</span> <span class="bp">self</span><span class="o">.</span><span class="n">iy</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_func</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([(</span><span class="kc">None</span><span class="p">,</span> <span class="n">_pass</span><span class="p">)]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="p">[(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_set_obj</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_vec</span><span class="p">]):</span>  <span class="c1"># loop: y_obj with parameters from y_vec if 3D else pass(None)</span>
                        <span class="n">y_func</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tdy</span><span class="p">)</span>
                        <span class="c1"># log function</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_function</span> <span class="o">!=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
                            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_function</span><span class="p">):</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_log</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">())])</span>  <span class="c1"># np.asarray(f(), dtype=float)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_log</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_log</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_log</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">())</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_log</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_log</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_log</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iy</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">())</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_log</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_log</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ix</span><span class="p">],</span> <span class="n">reset</span><span class="o">=</span><span class="n">_rst_log_hdf_appnd</span><span class="p">)</span>
                                    <span class="n">_rst_log_hdf_appnd</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_vec</span><span class="p">))</span>
                        <span class="c1"># iterate sweeps and take data</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_get_sweepdata</span><span class="p">()</span>
                    <span class="c1"># filling of value-box by storing data in the next 2d structure after every y-loop</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="ow">is</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">lst</span> <span class="ow">in</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_dVdI</span><span class="p">])</span> <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dVdI</span><span class="p">)]:</span>
                            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_nos</span><span class="p">()):</span>
                                <span class="n">lst</span><span class="p">[</span><span class="n">val</span><span class="p">]</span><span class="o">.</span><span class="n">next_matrix</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39; end measurement &#39;&#39;&#39;</span>
            <span class="n">qkit</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">qviewkit</span><span class="o">.</span><span class="n">save_plots</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">get_filepath</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_comment</span><span class="p">])</span>
            <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">close_file</span><span class="p">()</span>
            <span class="n">waf</span><span class="o">.</span><span class="n">close_log_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_IVD_status</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Measurement complete: </span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">get_filepath</span><span class="p">()))</span>
        <span class="k">return</span>
    
    <span class="k">def</span> <span class="nf">_prepare_measurement_IVD</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        All the relevant settings from the IVD are updated and called.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sweep_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IVD</span><span class="o">.</span><span class="n">get_sweep_mode</span><span class="p">()</span>  <span class="c1"># 0 (VV-mode) | 1 (IV-mode) | 2 (VI-mode) | 3 (II-mode)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IVD</span><span class="o">.</span><span class="n">get_sweep_bias</span><span class="p">()</span>  <span class="c1"># 0 (current bias) | 1 (voltage bias)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_IV_modes</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_IV_units</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_IVD_status</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="k">def</span> <span class="nf">_set_IVD_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the output status of the used IVD (of channel &lt;**kwargs&gt;) to &lt;status&gt;.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        status: bool</span>
<span class="sd">            Output status of used IV-device.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IVD</span><span class="o">.</span><span class="n">get_sweep_channels</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_IVD</span><span class="o">.</span><span class="n">set_status</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="n">channel</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="k">def</span> <span class="nf">_prepare_measurement_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates one file each for data (.h5) with distinct dataset structures for each measurement dimension, settings (.set), logging (.log) and measurement (.measurement).</span>
<span class="sd">        At this point all measurement parameters are known and put in the output files.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; create files &#39;&#39;&#39;</span>
        <span class="c1"># data.h5 file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span> <span class="o">=</span> <span class="n">hdf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;xy&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="ow">is</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="si">{:d}</span><span class="s1">D_IV_curve&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expname</span><span class="p">)))),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="c1"># settings.set file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_textlist</span><span class="p">(</span><span class="s1">&#39;settings&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_settings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">waf</span><span class="o">.</span><span class="n">get_instrument_settings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">get_filepath</span><span class="p">()))</span>
        <span class="c1"># logging.log file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_file</span> <span class="o">=</span> <span class="n">waf</span><span class="o">.</span><span class="n">open_log_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">get_filepath</span><span class="p">())</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; measurement object, sample object &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">_uuid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">hdf_relpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">_relpath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">instruments</span> <span class="o">=</span> <span class="n">qkit</span><span class="o">.</span><span class="n">instruments</span><span class="o">.</span><span class="n">get_instrument_names</span><span class="p">()</span>  <span class="c1"># qkit.instruments.get_instruments() #</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">sample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">sweeps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_sweeps</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">average</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_average</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_average</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">average</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_average</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_textlist</span><span class="p">(</span><span class="s1">&#39;measurement&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_mo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_measurement_object</span><span class="o">.</span><span class="n">get_JSON</span><span class="p">())</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; data variables &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_bias</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_dVdI</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_fit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_fit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39; xy &#39;&#39;&#39;</span>
            <span class="c1"># add data variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_coordinate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_name</span><span class="p">,</span>
                                                         <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_unit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_y</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_value_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_name</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span><span class="p">,</span>
                                                            <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_unit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                            <span class="n">save_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_func</span><span class="p">)]</span>
            <span class="c1"># add views</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view_xy</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view_xy</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_view_xy</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_y</span><span class="p">)))</span>
                                     <span class="k">for</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_y</span><span class="p">)[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">::]]</span>
                <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view_xy</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">_vs_</span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_name</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">view</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])]),</span>
                                             <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_y</span><span class="p">[</span><span class="n">view</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                             <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_y</span><span class="p">[</span><span class="n">view</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39; 1D scan &#39;&#39;&#39;</span>
            <span class="c1"># add data variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">create_iterator</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_nos</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_bias</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_coordinate</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">_b_</span><span class="si">{!s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_IV_modes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_bias</span><span class="p">],</span> <span class="n">i</span><span class="p">),</span>
                                                                     <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_IV_units</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_bias</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_bias_values</span><span class="p">(</span><span class="n">sweep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_sweep</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_value_vector</span><span class="p">(</span><span class="s1">&#39;I_</span><span class="si">{!s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                    <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_bias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                    <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
                                                                    <span class="n">save_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_value_vector</span><span class="p">(</span><span class="s1">&#39;V_</span><span class="si">{!s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                    <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_bias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                    <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">,</span>
                                                                    <span class="n">save_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dVdI</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_dVdI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_value_vector</span><span class="p">(</span><span class="s1">&#39;dVdI_</span><span class="si">{!s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                           <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_bias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;V/A&#39;</span><span class="p">,</span>
                                                                           <span class="n">save_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                           <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;analysis&#39;</span><span class="p">,</span>
                                                                           <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_numder_comment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">+</span>
                                                                                   <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_numder_comment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_func</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_value_vector</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">_</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_name</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span>
                                                                          <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                                                                          <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_unit</span><span class="p">,</span>
                                                                          <span class="n">save_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                          <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;analysis&#39;</span><span class="p">,</span>
                                                                          <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_fit_comment</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="c1"># log-function</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_log_value_vector</span><span class="p">()</span>
            <span class="c1"># add views</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_views</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39; 2D scan &#39;&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_coordinate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_coordname</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_unit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span><span class="p">)</span>
            <span class="c1"># add data variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">create_iterator</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_nos</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_bias</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_coordinate</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">_b_</span><span class="si">{!s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_IV_modes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_bias</span><span class="p">],</span> <span class="n">i</span><span class="p">),</span>
                                                                     <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_IV_units</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_bias</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_bias_values</span><span class="p">(</span><span class="n">sweep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_sweep</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_value_matrix</span><span class="p">(</span><span class="s1">&#39;I_</span><span class="si">{!s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                    <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span><span class="p">,</span>
                                                                    <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_bias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                    <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
                                                                    <span class="n">save_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_value_matrix</span><span class="p">(</span><span class="s1">&#39;V_</span><span class="si">{!s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                    <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span><span class="p">,</span>
                                                                    <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_bias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                    <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">,</span>
                                                                    <span class="n">save_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dVdI</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_dVdI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_value_matrix</span><span class="p">(</span><span class="s1">&#39;dVdI_</span><span class="si">{!s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                           <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span><span class="p">,</span>
                                                                           <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_bias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;V/A&#39;</span><span class="p">,</span>
                                                                           <span class="n">save_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                           <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;analysis&#39;</span><span class="p">,</span>
                                                                           <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_numder_comment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">+</span>
                                                                                   <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_numder_comment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_func</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_value_vector</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">_</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_name</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span>
                                                                          <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span><span class="p">,</span>
                                                                          <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_unit</span><span class="p">,</span>
                                                                          <span class="n">save_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                          <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;analysis&#39;</span><span class="p">,</span>
                                                                          <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_fit_comment</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="c1"># log-function</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_log_value_vector</span><span class="p">()</span>
            <span class="c1"># add views</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_views</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39; 3D scan &#39;&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_coordinate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_coordname</span><span class="p">,</span>
                                                         <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_unit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_coordinate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_coordname</span><span class="p">,</span>
                                                         <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_unit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_y</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_vec</span><span class="p">)</span>
            <span class="c1"># add data variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">create_iterator</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_nos</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_bias</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_coordinate</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">_b_</span><span class="si">{!s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_IV_modes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_bias</span><span class="p">],</span> <span class="n">i</span><span class="p">),</span>
                                                                     <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_IV_units</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_bias</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_bias_values</span><span class="p">(</span><span class="n">sweep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_sweep</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_value_box</span><span class="p">(</span><span class="s1">&#39;I_</span><span class="si">{!s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                 <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span><span class="p">,</span>
                                                                 <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_y</span><span class="p">,</span>
                                                                 <span class="n">z</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_bias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                 <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
                                                                 <span class="n">save_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_value_box</span><span class="p">(</span><span class="s1">&#39;V_</span><span class="si">{!s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                 <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span><span class="p">,</span>
                                                                 <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_y</span><span class="p">,</span>
                                                                 <span class="n">z</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_bias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                 <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">,</span>
                                                                 <span class="n">save_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dVdI</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_dVdI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_value_box</span><span class="p">(</span><span class="s1">&#39;dVdI_</span><span class="si">{!s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                        <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span><span class="p">,</span>
                                                                        <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_y</span><span class="p">,</span>
                                                                        <span class="n">z</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_bias</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                        <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;V/A&#39;</span><span class="p">,</span>
                                                                        <span class="n">save_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                        <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;analysis&#39;</span><span class="p">,</span>
                                                                        <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_numder_comment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">+</span>
                                                                                <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_numder_comment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_func</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_value_matrix</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">_</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_name</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span>
                                                                          <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span><span class="p">,</span>
                                                                          <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_y</span><span class="p">,</span>
                                                                          <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_unit</span><span class="p">,</span>
                                                                          <span class="n">save_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                          <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;analysis&#39;</span><span class="p">,</span>
                                                                          <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_fit_comment</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_vec</span><span class="p">)))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="c1"># log-function</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_log_value_vector</span><span class="p">()</span>
            <span class="c1"># add views</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_views</span><span class="p">()</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; add comment &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comment</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_comment</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_prepare_progress_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a progress bar using ipywidgets to show the measurement progress.</span>
<span class="sd">        Usually the number of performed sweeps, but in case of landscape scans entire number of bias points, is used as number of iterations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="p">:</span>
            <span class="c1"># number of iterations as number of performed sweeps</span>
            <span class="n">num_its</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span><span class="p">),</span>
                       <span class="mi">1</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_nos</span><span class="p">()</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_average</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_average</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                       <span class="mi">2</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_nos</span><span class="p">()</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_average</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_average</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                       <span class="mi">3</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_vec</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_nos</span><span class="p">()</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_average</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_average</span><span class="p">][</span><span class="mi">0</span><span class="p">]}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_landscape</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
                <span class="c1"># use entire number of bias points as number of iterations to estimate measurement time better</span>
                <span class="n">bias_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_bias_values</span><span class="p">(</span><span class="n">sweep</span><span class="p">),</span>
                                                    <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
                                        <span class="k">for</span> <span class="n">sweep</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_sweeps</span><span class="p">()])</span>
                <span class="n">lsc_limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_lsc_vec</span><span class="p">,</span>
                                        <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_lsc_vec</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lsc_mirror</span>
                                        <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_sweeps</span><span class="p">())[:,:</span><span class="mi">2</span><span class="p">]])</span>
                <span class="n">lsc_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">bias_values</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">bias_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lsc_limits</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                          <span class="n">bias_values</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">bias_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lsc_limits</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                <span class="n">num_its</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lsc_mask</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_vec</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_average</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_average</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pb_addend</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lsc_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">))))</span>  <span class="c1"># value that counter has to be increased after each sweep</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pb</span> <span class="o">=</span> <span class="n">Progress_Bar</span><span class="p">(</span><span class="n">max_it</span><span class="o">=</span><span class="n">num_its</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span><span class="p">],</span>
                                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;xy&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="ow">is</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="si">{:d}</span><span class="s1">D_IV_curve&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expname</span><span class="p">)))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;recording trace...&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_get_bias_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sweep</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a linearly distributed numpy-array of set bias values according to the sweep &lt;sweep&gt;.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sweep: array_likes of floats</span>
<span class="sd">            Sweep object containing start, stop, step and sleep values.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bias_values: numpy.array</span>
<span class="sd">            A linearly distributed numpy-array of given sweep parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sweep</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sweep</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">step</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sweep</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ndigits</span> <span class="o">=</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">step</span><span class="p">))))</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">nop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="n">step</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span> <span class="o">/</span> <span class="mi">100</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">nop</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span> <span class="o">+</span> <span class="n">start</span><span class="p">,</span> <span class="n">nop</span><span class="p">),</span> <span class="c1"># stop is rounded down to multiples of step</span>
                        <span class="n">decimals</span><span class="o">=</span><span class="n">ndigits</span><span class="p">)</span>  <span class="c1"># every element is rounded to overcome missing precision of numpy linspace</span>
    
    <span class="k">def</span> <span class="nf">_get_numder_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save numerical derivative method (function, arguments, keyword arguments) to analysis comment in the .h5 file.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name: str</span>
<span class="sd">            Name of dataseries.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{!s}</span><span class="s1">.</span><span class="si">{!s}</span><span class="s1">(&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_numder_func</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_numder_func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">+</span>\
               <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">name</span><span class="p">],</span>
                                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_numder_args</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_numder_args</span> <span class="k">else</span> <span class="p">[],</span>
                                         <span class="p">[</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">=</span><span class="si">{!s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_numder_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_numder_kwargs</span> <span class="k">else</span> <span class="p">[]]))</span><span class="o">+</span>\
               <span class="s1">&#39;)&#39;</span>

    <span class="k">def</span> <span class="nf">_get_fit_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save fit method (function, arguments, keyword arguments) to analysis comment in the .h5 file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{!s}</span><span class="s1">.</span><span class="si">{!s}</span><span class="s1">(&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_func</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">+</span>\
               <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="s1">&#39;I=</span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                                         <span class="s1">&#39;V=</span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                                         <span class="s1">&#39;dVdI=</span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_dVdI</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)],</span>
                                        <span class="p">[</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">=</span><span class="si">{!s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_kwargs</span> <span class="k">else</span> <span class="p">[]]))</span><span class="o">+</span>\
               <span class="s1">&#39;)&#39;</span>

    <span class="k">def</span> <span class="nf">_add_log_value_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds all value vectors for log-function parameter.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_function</span> <span class="o">!=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_log</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_log</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_function</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_coordinate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_name</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                        <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_unit</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_value_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_name</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                          <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span><span class="p">,</span>
                                                                          <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_unit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                          <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_dtype</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_value_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_name</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                          <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_x</span><span class="p">,</span>
                                                                          <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_y</span><span class="p">,</span>
                                                                          <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_unit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                                          <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_dtype</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_vec</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_vec</span><span class="p">)))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="k">def</span> <span class="nf">_add_views</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds views to the .h5-file. The view &quot;IV&quot; plots I(V) and contains the whole set of sweeps that are set.</span>
<span class="sd">        If &lt;dVdI&gt; is true, the view &quot;dVdI&quot; plots the differential gradient dV/dI(V) and contains the whole set of sweeps that are set.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_view_IV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="s1">&#39;IV&#39;</span><span class="p">,</span>
                                                     <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="n">view_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">),</span>
                                                                  <span class="s1">&#39;plot_style&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                                                  <span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_view_VI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="s1">&#39;VI&#39;</span><span class="p">,</span>
                                                     <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="n">view_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">),</span>
                                                                  <span class="s1">&#39;plot_style&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                                                  <span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_nos</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_view_IV</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_view_VI</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dVdI</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_view_dVdI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="s1">&#39;dVdI&#39;</span><span class="p">,</span>
                                                           <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                           <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_dVdI</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                           <span class="n">view_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;dVdI&#39;</span><span class="p">),</span>
                                                                        <span class="s1">&#39;plot_style&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                                                        <span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_nos</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_view_dVdI</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_bias</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                        <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_dVdI</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span>
    
    <span class="k">def</span> <span class="nf">_get_sweepdata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates sweeps of sweep class and takes data for each sweep.</span>
<span class="sd">        If average is set, traces are taken &lt;average&gt;-fold to average and saved after each iteration</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_average</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">create_iterator</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_nos</span><span class="p">()):</span>
                <span class="c1"># take data</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_IVD</span><span class="o">.</span><span class="n">get_sweep_mode</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> <span class="c1">#volt bias</span>
                    <span class="n">V_values</span><span class="p">,</span> <span class="n">I_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_IV</span><span class="p">(</span><span class="n">sweep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_sweep</span><span class="p">())</span>
                <span class="k">elif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_IVD</span><span class="o">.</span><span class="n">get_sweep_mode</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span> <span class="c1">#curr bias</span>
                    <span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_IV</span><span class="p">(</span><span class="n">sweep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_sweep</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Wrong sweep mode defined in SMU.&quot;</span><span class="p">)</span>

                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">[</span><span class="n">j</span><span class="p">]:(</span><span class="n">I_values</span><span class="p">,),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="p">[</span><span class="n">j</span><span class="p">]:(</span><span class="n">V_values</span><span class="p">,)}</span> <span class="c1"># tuple in oder to use *args later</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dVdI</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_dVdI</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_numerical_derivative</span><span class="p">(</span><span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span><span class="p">),)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_func</span><span class="p">:</span>
                    <span class="c1">#data[self._hdf_fit[j]] = self._fit_func(data[self._hdf_I[j]],</span>
                    <span class="c1">#                                        data[self._hdf_V[j]],</span>
                    <span class="c1">#                                        data[self._hdf_dVdI[j]],</span>
                    <span class="c1">#                                        **self._fit_kwargs)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_data_fit</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_func</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span>
                                                                           <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span>
                                                                           <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_dVdI</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span>
                                                                           <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_kwargs</span><span class="p">))</span>
                        <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_fit</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_fit</span><span class="p">[</span><span class="n">j</span><span class="p">],)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_data_fit</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_func</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span>
                                                                          <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span>
                                                                          <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_dVdI</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span>
                                                                          <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_kwargs</span><span class="p">))</span>
                        <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_fit</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_fit</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_data_fit</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iy</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_func</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span>
                                                                                   <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span>
                                                                                   <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_dVdI</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span>
                                                                                   <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_kwargs</span><span class="p">))</span>
                        <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_fit</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_fit</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ix</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rst_fit_hdf_appnd</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_fit_hdf_appnd</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_vec</span><span class="p">))</span>
                <span class="c1"># save data</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">key</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">*</span><span class="n">val</span><span class="p">)</span>
                <span class="c1"># iterate progress bar</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_pb</span><span class="o">.</span><span class="n">iterate</span><span class="p">(</span><span class="n">addend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pb_addend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ix</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_landscape</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">qkit</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_average</span><span class="p">):</span>
                <span class="n">I_values</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="n">V_values</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">create_iterator</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_nos</span><span class="p">()):</span>
                    <span class="c1"># take data</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_IVD</span><span class="o">.</span><span class="n">get_sweep_mode</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> <span class="c1">#volt bias</span>
                        <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">lst</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">take_IV</span><span class="p">(</span><span class="n">sweep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_sweep</span><span class="p">()),</span> <span class="p">[</span><span class="n">V_values</span><span class="p">,</span> <span class="n">I_values</span><span class="p">]):</span>
                            <span class="n">lst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>  <span class="c1"># append as list in order to later use zip</span>
                    <span class="k">elif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_IVD</span><span class="o">.</span><span class="n">get_sweep_mode</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span> <span class="c1">#curr bias</span>
                        <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">lst</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">take_IV</span><span class="p">(</span><span class="n">sweep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_sweep</span><span class="p">()),</span> <span class="p">[</span><span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span><span class="p">]):</span>
                            <span class="n">lst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>  <span class="c1"># append as list in order to later use zip</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Wrong sweep mode defined in SMU.&quot;</span><span class="p">)</span>

                    <span class="n">I_values_avg</span><span class="p">,</span> <span class="n">V_values_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">I_values</span><span class="p">))[</span><span class="n">j</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">V_values</span><span class="p">))[</span><span class="n">j</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># use zip since np.mean cannot handle different shapes</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span><span class="n">I_values_avg</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span><span class="n">V_values_avg</span><span class="p">}</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dVdI</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_dVdI</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_numerical_derivative</span><span class="p">(</span><span class="n">I_values_avg</span><span class="p">,</span> <span class="n">V_values_avg</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_func</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_fit</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_func</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span>
                                                                <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span>
                                                                <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_dVdI</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span>
                                                                <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_kwargs</span><span class="p">)</span>
                    <span class="c1"># save data</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">key</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>  <span class="c1"># append data series or overwrite last iteration by new averaged data</span>
                        <span class="n">key</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;(</span><span class="si">{:d}</span><span class="s1">/</span><span class="si">{:d}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_average</span><span class="p">)</span>  <span class="c1"># add (iteration/average) as attribute</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                    <span class="c1"># iterate progress bar</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_pb</span><span class="o">.</span><span class="n">iterate</span><span class="p">(</span><span class="n">addend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pb_addend</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ix</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_landscape</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># set average attribute to number of averages</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">get_nos</span><span class="p">()):</span>
                <span class="k">for</span> <span class="n">lst</span> <span class="ow">in</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf_I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_V</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hdf_dVdI</span><span class="p">])</span> <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dVdI</span><span class="p">)]:</span>
                    <span class="n">lst</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_average</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">qkit</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
        <span class="k">return</span>
    
<div class="viewcode-block" id="transport.take_IV"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.take_IV">[docs]</a>    <span class="k">def</span> <span class="nf">take_IV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sweep</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes IV and considers if landscape is set.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sweep: array_likes of floats</span>
<span class="sd">            Sweep object containing start, stop, step and sleep values.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        I_values: numpy.array(float)</span>
<span class="sd">            Measured current values.</span>
<span class="sd">        V_values: numpy.array(float)</span>
<span class="sd">            Measured voltage values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># take data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_landscape</span><span class="p">:</span>
            <span class="c1"># modify sweep by envelop of landscape function</span>
            <span class="n">bias_lim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lsc_vec</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ix</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lsc_mirror</span><span class="p">:</span>
                <span class="n">sweep_lsc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sweep</span><span class="p">),</span> <span class="p">[</span><span class="n">bias_lim</span><span class="p">,</span> <span class="n">bias_lim</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">sweep</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sweep_lsc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">([</span><span class="n">sweep</span><span class="p">,</span> <span class="p">[</span><span class="n">bias_lim</span><span class="p">,</span> <span class="n">bias_lim</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># find landscape bounds in full bias values</span>
            <span class="n">bias_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bias_values</span><span class="p">(</span><span class="n">sweep</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">bias_data</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sweep_lsc</span><span class="p">[:</span><span class="mi">2</span><span class="p">]),</span> <span class="n">bias_data</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sweep_lsc</span><span class="p">[:</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">sweep_lsc</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">bias_data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span> <span class="n">bias_data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># take data</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IVD</span><span class="o">.</span><span class="n">take_IV</span><span class="p">(</span><span class="n">sweep</span><span class="o">=</span><span class="n">sweep_lsc</span><span class="p">)</span>
            <span class="c1"># fill skipped bias values with np.nan to keep shape constant</span>
            <span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">arr</span><span class="o">=</span><span class="n">I_values</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">arr</span><span class="o">=</span><span class="n">V_values</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IVD</span><span class="o">.</span><span class="n">take_IV</span><span class="p">(</span><span class="n">sweep</span><span class="o">=</span><span class="n">sweep</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sweep</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">I_values</span><span class="p">,</span> <span class="n">V_values</span></div>
    
<div class="viewcode-block" id="transport.set_plot_comment"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.set_plot_comment">[docs]</a>    <span class="k">def</span> <span class="nf">set_plot_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comment</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set small comment to add at the end of plot pics for more information i.e. good for wiki entries.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        comment: str</span>
<span class="sd">            A comment that is added in the plot images.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_comment</span> <span class="o">=</span> <span class="n">comment</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="transport.sweep"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.sweep">[docs]</a>    <span class="k">class</span> <span class="nc">sweep</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a subclass of &lt;transport&gt; that provides the customized usage of many sweeps in one measurement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Initializes the sweep parameters as empty.</span>
<span class="sd">        </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            None</span>
<span class="sd">        </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            None</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_starts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stops</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_steps</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sleeps</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_iterator</span><span class="p">()</span>
            <span class="k">return</span>
        
<div class="viewcode-block" id="transport.sweep.create_iterator"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.sweep.create_iterator">[docs]</a>        <span class="k">def</span> <span class="nf">create_iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Creates iterator of start, stop, step and sleep arrays.</span>
<span class="sd">        </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            None</span>
<span class="sd">        </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            None</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_starts</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stop_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stops</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_step_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_steps</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sleep_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sleeps</span><span class="p">)</span>
            <span class="k">return</span></div>
        
<div class="viewcode-block" id="transport.sweep.add_sweep"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.sweep.add_sweep">[docs]</a>        <span class="k">def</span> <span class="nf">add_sweep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">sleep</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Adds a sweep object with given parameters.</span>
<span class="sd">        </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            start: float</span>
<span class="sd">                Start value of the sweep.</span>
<span class="sd">            stop: float</span>
<span class="sd">                Stop value of the sweep.</span>
<span class="sd">            step: float</span>
<span class="sd">                Step value of the sweep.</span>
<span class="sd">            sleep: float</span>
<span class="sd">                Sleep time after whole sweep. Default is 0.</span>
<span class="sd">        </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            None</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sleeps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sleep</span><span class="p">)</span>
            <span class="k">return</span></div>
        
<div class="viewcode-block" id="transport.sweep.reset_sweeps"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.sweep.reset_sweeps">[docs]</a>        <span class="k">def</span> <span class="nf">reset_sweeps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Resets sweeps.</span>
<span class="sd">        </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            None</span>
<span class="sd">        </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            None</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_starts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stops</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_steps</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sleeps</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">return</span></div>
        
<div class="viewcode-block" id="transport.sweep.get_sweep"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.sweep.get_sweep">[docs]</a>        <span class="k">def</span> <span class="nf">get_sweep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets sweep parameter.</span>
<span class="sd">        </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            None</span>
<span class="sd">        </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            sweep: tuple of floats</span>
<span class="sd">                Sweep object containing start, stop, step and sleep values.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_iter</span><span class="p">),</span>
                    <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stop_iter</span><span class="p">),</span>
                    <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_iter</span><span class="p">),</span>
                    <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sleep_iter</span><span class="p">))</span></div>
        
<div class="viewcode-block" id="transport.sweep.get_sweeps"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.sweep.get_sweeps">[docs]</a>        <span class="k">def</span> <span class="nf">get_sweeps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets parameters of all sweep.</span>
<span class="sd">        </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            None</span>
<span class="sd">        </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            sweep: list of floats</span>
<span class="sd">                Sweep object containing start, stop, step and sleep values.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_starts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stops</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sleeps</span><span class="p">]))</span></div>
        
<div class="viewcode-block" id="transport.sweep.get_nos"><a class="viewcode-back" href="../../../../qkit.measure.transport.html#qkit.measure.transport.transport.transport.sweep.get_nos">[docs]</a>        <span class="k">def</span> <span class="nf">get_nos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets number of sweeps.</span>
<span class="sd">        </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            None</span>
<span class="sd">        </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            nos: int</span>
<span class="sd">                Number of sweeps stored in this sweep-class.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_starts</span><span class="p">)</span></div></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, QKITgroup.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>