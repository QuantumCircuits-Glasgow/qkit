<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>qkit.drivers.Keithley_2450_gla &mdash; QKIT 0.3 alpha documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            QKIT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">qkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_notebooks/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Contributing.html">How to contribute</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">QKIT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">qkit.drivers.Keithley_2450_gla</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for qkit.drivers.Keithley_2450_gla</h1><div class="highlight"><pre>
<span></span><span class="c1"># filename: Keithley_2450.py</span>
<span class="c1"># version 0.1 written by </span>
<span class="c1"># QKIT driver for a Keithley Multimeter 2450</span>
<span class="c1"># Updated by Chisha &amp; Joao &lt;j.barbosa.1@research.gla.ac.uk&gt; 2023</span>

<span class="kn">import</span> <span class="nn">qkit</span>
<span class="kn">from</span> <span class="nn">qkit.core.instrument_base</span> <span class="kn">import</span> <span class="n">Instrument</span>

<span class="kn">from</span> <span class="nn">qkit</span> <span class="kn">import</span> <span class="n">visa</span> 

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span><span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">atexit</span>

<div class="viewcode-block" id="Keithley_2450_gla"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla">[docs]</a><span class="k">class</span> <span class="nc">Keithley_2450_gla</span><span class="p">(</span><span class="n">Instrument</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This is the driver for the Keithley 2450 Source Meter</span>
<span class="sd">    Set ip address manually on instrument, e.g. TCPIP::10.22.197.50::5025::SOCKET</span>
<span class="sd">    Usage:</span>
<span class="sd">    Initialize with</span>
<span class="sd">    &lt;name&gt; = qkit.instruments.create(&#39;&lt;name&gt;&#39;, &#39;Keithley_2450&#39;, address=&#39;&lt;IP address&gt;&#39;, reset=&lt;bool&gt;)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initializes the Keithley, and communicates with the wrapper.</span>
<span class="sd">        </span>
<span class="sd">        Input:</span>
<span class="sd">            name (string)    : name of the instrument</span>
<span class="sd">            address (string) : IP address</span>
<span class="sd">            reset (bool)     : resets to default values, default=False</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Start VISA communication</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;: Initializing instrument Keithley 2450&#39;</span><span class="p">)</span>
        <span class="n">Instrument</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;physical&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_address</span> <span class="o">=</span> <span class="n">address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span> <span class="o">=</span> <span class="n">visa</span><span class="o">.</span><span class="n">instrument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">read_termination</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">100000</span> <span class="c1">#big timeout required to wait for long sweeps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rvc_mode</span>   <span class="o">=</span> <span class="kc">False</span> <span class="c1">#resistance via current</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">four_wire</span>  <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meas_delay</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1">#delay between measurements in sweeps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bufferElementTable</span> <span class="o">=</span> <span class="p">{</span><span class="c1">#table of the possible options for bufferElements when used (specified in manual)</span>
            <span class="s2">&quot;DATE&quot;</span><span class="p">:</span> <span class="s2">&quot;The date when the data point was measured&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FORM&quot;</span><span class="p">:</span><span class="s2">&quot;The measured value as it appears on the front panel&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FRAC&quot;</span><span class="p">:</span><span class="s2">&quot;The fractional seconds for the data point when the data point was measured&quot;</span><span class="p">,</span>
            <span class="s2">&quot;READ&quot;</span><span class="p">:</span><span class="s2">&quot;The measurement reading based on the SENS:FUNC setting; if no buffer elements are defined, this option is used&quot;</span><span class="p">,</span>
            <span class="s2">&quot;REL&quot;</span><span class="p">:</span><span class="s2">&quot;The relative time when the data point was measured&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SEC&quot;</span><span class="p">:</span><span class="s2">&quot;The seconds in UTC (Coordinated Universal Time) format when the data point was measured&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SOUR&quot;</span><span class="p">:</span><span class="s2">&quot;The source value; if readback is ON, then it is the readback value, otherwise it is the programmed source value&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SOURFORM&quot;</span><span class="p">:</span><span class="s2">&quot;The source value as it appears on the display&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SOURSTAT&quot;</span><span class="p">:</span><span class="s2">&quot;The status information associated with sourcing&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SOURUNIT&quot;</span><span class="p">:</span><span class="s2">&quot;The unit of value associated with the source value&quot;</span><span class="p">,</span>
            <span class="s2">&quot;STAT&quot;</span><span class="p">:</span><span class="s2">&quot;The status information associated with the measurement The time for the data point&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TIME&quot;</span><span class="p">:</span><span class="s2">&quot;The timestamp for the data point&quot;</span><span class="p">,</span>
            <span class="s2">&quot;UNIT&quot;</span><span class="p">:</span><span class="s2">&quot;The unit of measure associated with the measurement&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">possibleModes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CURR&quot;</span><span class="p">,</span><span class="s2">&quot;VOLT&quot;</span><span class="p">,</span><span class="s2">&quot;RES&quot;</span><span class="p">]</span><span class="c1">#keithley can only be in these modes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">possibleBoundaries</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;MIN&quot;</span><span class="p">,</span><span class="s2">&quot;MAX&quot;</span><span class="p">,</span><span class="s2">&quot;DEF&quot;</span><span class="p">]</span>
        <span class="c1">#self.setup(address) #used for GPIB connections</span>

<div class="viewcode-block" id="Keithley_2450_gla.reset"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Resets the instrument to default values</span>

<span class="sd">        Input:</span>
<span class="sd">            None</span>

<span class="sd">        Output:</span>
<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39; : resetting instrument&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;*RST&#39;</span><span class="p">)</span></div>
        <span class="c1">#self.get_all()     </span>
    

<div class="viewcode-block" id="Keithley_2450_gla.get_current_dc"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.get_current_dc">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_dc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>   <span class="c1">#Return DC Current in auto-range</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;:MEAS:CURR:DC?&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="k">return</span>         </div>
    
<div class="viewcode-block" id="Keithley_2450_gla.get_voltage_dc"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.get_voltage_dc">[docs]</a>    <span class="k">def</span> <span class="nf">get_voltage_dc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>   <span class="c1">#Return DC Current in auto-range</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;:MEAS:VOLT:DC?&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="k">return</span>       </div>

<div class="viewcode-block" id="Keithley_2450_gla.get_resistance_2W"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.get_resistance_2W">[docs]</a>    <span class="k">def</span> <span class="nf">get_resistance_2W</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;:OUTP ON&quot;</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;:MEAS:RES?&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;:OUTP OFF&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">NaN</span></div>

<div class="viewcode-block" id="Keithley_2450_gla.get_resistance_4W"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.get_resistance_4W">[docs]</a>    <span class="k">def</span> <span class="nf">get_resistance_4W</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;:OUTP ON&quot;</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;:MEAS:RES?&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;:OUTP OFF&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">NaN</span></div>

<div class="viewcode-block" id="Keithley_2450_gla.set_4W"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.set_4W">[docs]</a>    <span class="k">def</span> <span class="nf">set_4W</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; Sets 2 or 4 wire measurement mode </span>
<span class="sd">        0 - 2-wire measurement, and 1 - 4-wire measurement&#39;&#39;&#39;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">four_wire</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">four_wire</span><span class="o">=</span><span class="kc">False</span>

        <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sense_mode</span><span class="p">()</span>
        <span class="k">if</span><span class="p">(</span><span class="s2">&quot;VOLT&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;VOLT:RSEN </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
        <span class="k">elif</span><span class="p">(</span><span class="s2">&quot;CURR&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CURR:RSEN </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Non defined sensing mode (VOLT or CURR only)&quot;</span><span class="p">)</span>
        <span class="k">return</span>    </div>
        
<div class="viewcode-block" id="Keithley_2450_gla.set_current_range"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.set_current_range">[docs]</a>    <span class="k">def</span> <span class="nf">set_current_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">range_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;:SENS:CURR:RANG </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">range_value</span><span class="p">))</span></div>

<div class="viewcode-block" id="Keithley_2450_gla.set_voltage_source"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.set_voltage_source">[docs]</a>    <span class="k">def</span> <span class="nf">set_voltage_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volt</span><span class="p">):</span>
        <span class="c1">#self._visainstrument.write(&quot;SENS:FUNC &#39;CURR&#39;&quot;) </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SOUR:FUNC VOLT&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SOUR:VOLT </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">volt</span><span class="p">))</span></div>

<div class="viewcode-block" id="Keithley_2450_gla.set_current_source"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.set_current_source">[docs]</a>    <span class="k">def</span> <span class="nf">set_current_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curr</span><span class="p">):</span>
        <span class="c1">#self._visainstrument.write(&quot;SENS:FUNC &#39;VOLT&#39;&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SOUR:FUNC CURR&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SOUR:CURR </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">curr</span><span class="p">))</span></div>

<div class="viewcode-block" id="Keithley_2450_gla.set_voltage_range"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.set_voltage_range">[docs]</a>    <span class="k">def</span> <span class="nf">set_voltage_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">range_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;:SENS:VOLT:RANG </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">range_value</span><span class="p">))</span></div>

<div class="viewcode-block" id="Keithley_2450_gla.set_current_range_auto"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.set_current_range_auto">[docs]</a>    <span class="k">def</span> <span class="nf">set_current_range_auto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auto</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">auto</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;:SENS:CURR:RANG:AUTO ON&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;:SENS:CURR:RANG:AUTO OFF&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Keithley_2450_gla.set_voltage_range_auto"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.set_voltage_range_auto">[docs]</a>    <span class="k">def</span> <span class="nf">set_voltage_range_auto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auto</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">auto</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;:SENS:VOLT:RANG:AUTO ON&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;:SENS:VOLT:RANG:AUTO OFF&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Keithley_2450_gla.set_nplc"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.set_nplc">[docs]</a>    <span class="k">def</span> <span class="nf">set_nplc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nplc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Sets the number of power line cycles, aka, the time that the input signal is measured for </span>
<span class="sd">            </span>
<span class="sd">            Parameters</span>
<span class="sd">            -------</span>
<span class="sd">            nplc: number of cycles (time= nplc/60Hz in seconds)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sense_mode</span><span class="p">()</span>
        <span class="k">if</span><span class="p">(</span><span class="s2">&quot;VOLT&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;VOLT:NPLC </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nplc</span><span class="p">))</span>
        <span class="k">elif</span><span class="p">(</span><span class="s2">&quot;CURR&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CURR:NPLC </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nplc</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Non defined sensing mode (VOLT or CURR only)&quot;</span><span class="p">)</span>
        <span class="k">return</span>    </div>

<div class="viewcode-block" id="Keithley_2450_gla.get_nplc"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.get_nplc">[docs]</a>    <span class="k">def</span> <span class="nf">get_nplc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Gets number of power line cycles</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_sense_mode</span><span class="p">()</span>
        <span class="k">if</span><span class="p">(</span><span class="s2">&quot;VOLT&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;VOLT:NPLC?&#39;</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="s2">&quot;CURR&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CURR:NPLC?&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Non defined sensing mode (VOLT or CURR only)&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Keithley_2450_gla.printBufferElementTable"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.printBufferElementTable">[docs]</a>    <span class="k">def</span> <span class="nf">printBufferElementTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">includeDetails</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Print out the buffer element table, with an option to include the details of each element&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">includeDetails</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Possible buffer elements, including descriptions:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">elmt</span><span class="p">,</span> <span class="n">desc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bufferElementTable</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{element}</span><span class="s2">&#39;: </span><span class="si">{description}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">elmt</span><span class="p">,</span><span class="n">description</span> <span class="o">=</span> <span class="n">desc</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Possible buffer elements:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bufferElementTable</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span></div>

    <span class="k">def</span> <span class="nf">_validateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">readingElements</span><span class="p">:</span><span class="s2">&quot;tuple[str,...]&quot;</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">boundary</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">-&gt;</span> <span class="s2">&quot;tuple[bool, str]&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        For each scpi function, call this method and provide the relevant parameters to validate entries</span>

<span class="sd">        Returns a (bool,str) tuple, where 1st element (bool) indicates true/false for success/failure </span>
<span class="sd">         and 2nd element (str) indicates description of failure</span>
<span class="sd">        </span>
<span class="sd">        Leave the unwanted parameters = None if you dont want to validate them</span>

<span class="sd">        Supported parameters:</span>
<span class="sd">        - readingElements (refer to bufferElementsTable)</span>
<span class="sd">        - mode (&#39;CURR&#39;, &#39;VOLT&#39; &#39;RES&#39;)</span>
<span class="sd">        - boundary (&#39;DEF&#39;, &#39;MIN&#39;, &#39;MAX&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Validating Parameters&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mode</span><span class="o">!=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibleModes</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span><span class="s2">&quot;Invalid mode&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">readingElements</span><span class="o">!=</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">readingElements</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">readingElements</span><span class="p">:</span><span class="c1">#making sure each buffer element is correct</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bufferElementTable</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span><span class="s2">&quot;Invalid Buffer Element&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">boundary</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">boundary</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">possibleBoundaries</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span><span class="s2">&quot;Invalid boundary values&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="c1">#then return true if all checks go fine</span>
   
<div class="viewcode-block" id="Keithley_2450_gla.get_latest_reading"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.get_latest_reading">[docs]</a>    <span class="k">def</span> <span class="nf">get_latest_reading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bufferName</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;defbuffer1&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">readingElements</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the latest reading from a given/default reading buffer</span>

<span class="sd">        - &#39;bufferName&#39;: (optional) name of buffer where &#39;defbuffer1&#39; is the default buffer</span>

<span class="sd">        - &#39;readingElements&#39;: (optional) variadic paramters (up to of 14) determining what aspects of the reading get returned</span>
<span class="sd">            E.g: &#39;DATE&#39;, &#39;UNIT&#39;</span>
<span class="sd">        </span>
<span class="sd">        Note: if you want to add readingElements, you need to specify bufferName first</span>
<span class="sd">        </span>
<span class="sd">        If you&#39;re not sure what bufferName to use, use &#39;defbuffer1&#39; (default)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Getting latest reading&quot;</span><span class="p">)</span>
        <span class="c1">#preventive error handling</span>
        <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validateParameters</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="n">readingElements</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">test</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:&quot;</span><span class="p">,</span><span class="n">test</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">readingElements</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span><span class="c1">#for correct formatting of query, need to handle differently if no elements passed </span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:FETCh &quot;</span><span class="si">{bName}</span><span class="s1">&quot;, </span><span class="si">{elements}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bName</span> <span class="o">=</span> <span class="n">bufferName</span><span class="p">,</span><span class="n">elements</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">readingElements</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:FETCh &quot;</span><span class="si">{bName}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bName</span> <span class="o">=</span> <span class="n">bufferName</span><span class="p">))</span><span class="c1">#just get the plain reading as it is</span></div>
    

<div class="viewcode-block" id="Keithley_2450_gla.make_measurement"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.make_measurement">[docs]</a>    <span class="k">def</span> <span class="nf">make_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">bufferName</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;defbuffer1&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">readingElements</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Makes a measurement using the specified function mode, stores and returns the measurement in a reading buffer</span>

<span class="sd">        - &#39;mode&#39;: specify either &#39;CURR&#39;, &#39;RES&#39;, &#39;VOLT&#39; to get a current, resistance or voltage measurement respectively</span>

<span class="sd">        - &#39;bufferName&#39;: (optional) name of buffer where &#39;defbuffer1&#39; is the default buffer</span>

<span class="sd">        - &#39;readingElements&#39;: (optional) variadic paramters (up to 14) determining what aspects of the reading get returned (look up bufferElementTable)</span>
<span class="sd">        </span>
<span class="sd">        Note: </span>

<span class="sd">            - if you want to add readingElements, you need to specify bufferName first</span>

<span class="sd">            - If you&#39;re not sure what bufferName to use, use &#39;defbuffer1&#39; (default)</span>

<span class="sd">            - the &#39;mode&#39; parameter will change the measurement function to the specified one, and this change will persist</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Making measurement&quot;</span><span class="p">)</span>
        <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validateParameters</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span><span class="n">readingElements</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">test</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:&quot;</span><span class="p">,</span><span class="n">test</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">readingElements</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:MEAS:</span><span class="si">{mode}</span><span class="s1">? &quot;</span><span class="si">{bName}</span><span class="s1">&quot;, </span><span class="si">{elements}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">bName</span> <span class="o">=</span> <span class="n">bufferName</span><span class="p">,</span><span class="n">elements</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">readingElements</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:MEAS:</span><span class="si">{mode}</span><span class="s1">? &quot;</span><span class="si">{bName}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span><span class="n">bName</span><span class="o">=</span><span class="n">bufferName</span><span class="p">))</span></div>

    <span class="c1">#Display (:DISPlay) function</span>
<div class="viewcode-block" id="Keithley_2450_gla.set_display_digits"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.set_display_digits">[docs]</a>    <span class="k">def</span> <span class="nf">set_display_digits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">numDigits</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span><span class="n">mode</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set the number of digits displayed on the front panel for a given measurement function (changes will persist)</span>
<span class="sd">         - &#39;mode&#39;: specify either &#39;CURR&#39;, &#39;RES&#39;, &#39;VOLT&#39; to get current, resistance or voltage measurement functions respectively</span>
<span class="sd">                - if mode is set to None, then all 3 measurement functions will be changed </span>
<span class="sd">         - &#39;numDigits&#39;: the number of digits to set the display to. Use an integer value</span>
<span class="sd">        </span>
<span class="sd">        Note: this does NOT affect the accuracy or speed of measurements.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting display digits&quot;</span><span class="p">)</span>
        <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validateParameters</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">test</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:&quot;</span><span class="p">,</span><span class="n">test</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">numDigits</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">numDigits</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span><span class="c1">#then all 3 measurement functions get changed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:DISP:DIG </span><span class="si">{digits}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="n">numDigits</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:DISP:</span><span class="si">{mode}</span><span class="s1">:DIG: </span><span class="si">{digits}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="p">,</span><span class="n">digits</span><span class="o">=</span><span class="n">numDigits</span><span class="p">))</span></div>

<div class="viewcode-block" id="Keithley_2450_gla.get_display_digits"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.get_display_digits">[docs]</a>    <span class="k">def</span> <span class="nf">get_display_digits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">boundary</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the number of digits dispayed for a given measurement function</span>
<span class="sd">        - &#39;mode&#39;: specify either &#39;CURR&#39;, &#39;RES&#39;, &#39;VOLT&#39; to get current, resistance or voltage measurement functions respectively</span>
<span class="sd">        - &#39;boundary&#39;: (optional) specify the following string values to get the relevant data:</span>
<span class="sd">                - DEF to get to the default number of digits</span>
<span class="sd">                - MIN to get to the minimum number of digits allowed</span>
<span class="sd">                - MAX to get to the maximum number of digits allowed </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;getting number of digits displayed&quot;</span><span class="p">)</span>
        <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validateParameters</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">boundary</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">test</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:&quot;</span><span class="p">,</span><span class="n">test</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">boundary</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:DISP:</span><span class="si">{mode}</span><span class="s1">:DIG?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:DISP:</span><span class="si">{mode}</span><span class="s1">:DIG? </span><span class="si">{boundary}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span><span class="n">boundary</span><span class="o">=</span><span class="n">boundary</span><span class="p">)))</span></div>
        
<div class="viewcode-block" id="Keithley_2450_gla.get_bias_mode"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.get_bias_mode">[docs]</a>    <span class="k">def</span> <span class="nf">get_bias_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets bias mode &lt;mode&gt;.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mode: String</span>
<span class="sd">            Bias mode. &quot;VOLT&quot; for voltage, &quot;CURR&quot; for current</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:SOUR:FUNC?&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="Keithley_2450_gla.get_sense_mode"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.get_sense_mode">[docs]</a>    <span class="k">def</span> <span class="nf">get_sense_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets sense mode &lt;mode&gt;.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mode: String</span>
<span class="sd">            Bias mode. &quot;VOLT&quot; for voltage, &quot;CURR&quot; for current</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:SENS:FUNC?&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Keithley_2450_gla.get_sweep_mode"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.get_sweep_mode">[docs]</a>    <span class="k">def</span> <span class="nf">get_sweep_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span class="c1">#find manual for setting the sweep &quot;mode&quot;</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Either:</span>
<span class="sd">         * voltage is both applied and measured (VV-mode),</span>
<span class="sd">         * current is applied and voltage is measured (IV-mode),</span>
<span class="sd">         * voltage is applied and current is measured (VI-mode),</span>
<span class="sd">         * current is both applied and measured (II-mode).</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mode: int</span>
<span class="sd">            Sweep mode denoting bias and sense modes. Meanings are 0 (VV-mode), 1 (IV-mode), 2 (VI-mode), or 3 (II-mode).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sourceMode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bias_mode</span><span class="p">()</span> <span class="c1">#the independent variable that will be swept over</span>
        <span class="n">senseMode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sense_mode</span><span class="p">()</span> <span class="c1">#the dependant variable that will be measured</span>
        <span class="c1">#print(sourceMode,senseMode)</span>
        <span class="k">if</span> <span class="s2">&quot;VOLT&quot;</span> <span class="ow">in</span> <span class="n">sourceMode</span> <span class="ow">and</span> <span class="s2">&quot;VOLT&quot;</span> <span class="ow">in</span> <span class="n">senseMode</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span> <span class="c1">#VV mode</span>
        <span class="k">elif</span> <span class="s2">&quot;CURR&quot;</span> <span class="ow">in</span> <span class="n">sourceMode</span> <span class="ow">and</span> <span class="s2">&quot;VOLT&quot;</span> <span class="ow">in</span> <span class="n">senseMode</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="c1">#IV mode</span>
        <span class="k">elif</span> <span class="s2">&quot;VOLT&quot;</span> <span class="ow">in</span> <span class="n">sourceMode</span> <span class="ow">and</span> <span class="s2">&quot;CURR&quot;</span> <span class="ow">in</span> <span class="n">senseMode</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">2</span> <span class="c1">#VI mode</span>
        <span class="k">elif</span> <span class="s2">&quot;CURR&quot;</span> <span class="ow">in</span> <span class="n">sourceMode</span> <span class="ow">and</span> <span class="s2">&quot;CURR&quot;</span> <span class="ow">in</span> <span class="n">senseMode</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">3</span> <span class="c1"># II mode</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unkown sweep mode&quot;</span><span class="p">)</span> </div>
            
<div class="viewcode-block" id="Keithley_2450_gla.set_sweep_mode"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.set_sweep_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_sweep_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sourceMode</span><span class="p">,</span><span class="n">measureMode</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        - sourceMode: mode to sweep. Either &#39;VOLTage&#39; or &#39;CURR&#39;</span>
<span class="sd">        - measureMode: mode to measure sweep of. Either &#39;VOLT&#39; or &#39;CURR&#39;</span>
<span class="sd">        </span>
<span class="sd">        Either:</span>
<span class="sd">         * voltage is both applied and measured (VV-mode),</span>
<span class="sd">         * current is applied and voltage is measured (IV-mode),</span>
<span class="sd">         * voltage is applied and current is measured (VI-mode),</span>
<span class="sd">         * current is both applied and measured (II-mode).</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">         None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#first validate the modes</span>
        <span class="k">if</span> <span class="n">sourceMode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CURR&quot;</span><span class="p">,</span><span class="s2">&quot;VOLT&quot;</span><span class="p">,</span><span class="s2">&quot;CURRent&quot;</span><span class="p">,</span> <span class="s2">&quot;VOLTage&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sorry, invalid source mode passed. Please use &#39;CURR&#39; or &#39;VOLT&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid sourceMode passed&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">measureMode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CURR&quot;</span><span class="p">,</span><span class="s2">&quot;VOLT&quot;</span><span class="p">,</span><span class="s2">&quot;CURRent&quot;</span><span class="p">,</span><span class="s2">&quot;VOLTage&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sorry, invalid measure mode passed. Please use &#39;CURR&#39; or &#39;VOLT&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid measureMode passed&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*CLS&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:SOUR:FUNC </span><span class="si">{sourceMode}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sourceMode</span><span class="o">=</span><span class="n">sourceMode</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:SENS:FUNC &quot;</span><span class="si">{measureMode}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">measureMode</span><span class="o">=</span><span class="n">measureMode</span><span class="p">))</span></div>

<div class="viewcode-block" id="Keithley_2450_gla.get_sweep_bias"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.get_sweep_bias">[docs]</a>    <span class="k">def</span> <span class="nf">get_sweep_bias</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls get_bias_mode. This method is needed for qkit.measure.transport.transport.py in case of no virtual tunnel electronic.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mode: int</span>
<span class="sd">            Bias mode. Meanings are 0 (current) and 1 (voltage).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">biasMode</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bias_mode</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">biasMode</span> <span class="o">==</span> <span class="s2">&quot;CURR&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">biasMode</span> <span class="o">==</span> <span class="s2">&quot;VOLT&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unkown bias mode&quot;</span><span class="p">)</span> </div>

<div class="viewcode-block" id="Keithley_2450_gla.get_sweep_channels"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.get_sweep_channels">[docs]</a>    <span class="k">def</span> <span class="nf">get_sweep_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span class="c1">#always return 1</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Due to the functionality of the Keithlet 2450, there is only 1 channel. </span>
<span class="sd">        </span>
<span class="sd">        So this function will only return 1 (though is still needed to be compatible with transport class)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="Keithley_2450_gla.set_status"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.set_status">[docs]</a>    <span class="k">def</span> <span class="nf">set_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">status</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span><span class="c1">#should be able to do</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This command enables or disables the source output</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        status: int</span>
<span class="sd">            Output status. Possible values are 0 (off) and 1 (on)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="o">==</span><span class="kc">True</span><span class="p">):</span> <span class="n">status</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="o">==</span><span class="kc">False</span><span class="p">):</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:OUTP </span><span class="si">{s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span> <span class="o">=</span> <span class="n">status</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Wrong Status (must be 0 or 1)&quot;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Keithley_2450_gla.get_status"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.get_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This command simply checks if the source output is on or off</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:OUTP?&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Keithley_2450_gla.take_IV"><a class="viewcode-back" href="../../../qkit.drivers.html#qkit.drivers.Keithley_2450_gla.Keithley_2450_gla.take_IV">[docs]</a>    <span class="k">def</span> <span class="nf">take_IV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sweep</span><span class="p">):</span><span class="c1">#this one should do all 4 (IV, VV, VI, II)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes IV curve with sweep parameters &lt;sweep&gt; in the sweep mode predefined.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sweep: 5 element float list where : </span>
<span class="sd">            - sweep[0] is the start value</span>
<span class="sd">            - sweep[1] is the stop value</span>
<span class="sd">            - sweep[2] is the step width (MUST BE GREATER THAN 0)</span>
<span class="sd">            - sweep[3] is the delay between measuring points (in seconds)</span>
<span class="sd">            - sweep[4] is the number of times to perform the sweep (0 for infinite loop)</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bias_values: numpy.array(float)</span>
<span class="sd">            Measured bias values.</span>
<span class="sd">        sense_values: numpy.array(float)</span>
<span class="sd">            Measured sense values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;:TRAC:CLE &#39;defbuffer1&#39;&quot;</span><span class="p">)</span><span class="c1">#first clear the buffer</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">sweep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">sweep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">sweep</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meas_delay</span> <span class="c1">#sweep[3]</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#sweep[4]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid sweep parameter. Provide a 5 element array&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1">#setting up sweep parameters</span>
        <span class="n">numSteps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span><span class="o">/</span><span class="n">step</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="c1">#needed for reading out data</span>
        <span class="n">sweepMode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_mode</span><span class="p">()</span>
        <span class="n">bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bias_mode</span><span class="p">()</span><span class="c1">#so that we correctly write the sweep command</span>
        <span class="k">if</span> <span class="n">sweepMode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span><span class="c1"># VV mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:SENS:FUNC &quot;VOLT&quot;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sweeping voltage, measuring voltage&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sweepMode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span><span class="c1"># IV mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:SENS:FUNC &quot;VOLT&quot;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sweeping current, measuring voltage&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sweepMode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span><span class="c1"># VI mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:SENS:FUNC &quot;CURR&quot;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sweeping voltage, measuring current&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sweepMode</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span><span class="c1"># II mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:SENS:FUNC &quot;CURR&quot;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sweeping current, measuring current&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid sweep mode passed in&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid sweep mode&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:SOUR:SWE:</span><span class="si">{bias}</span><span class="s1">:LIN:STEP </span><span class="si">{start}</span><span class="s1">, </span><span class="si">{stop}</span><span class="s1">, </span><span class="si">{step}</span><span class="s1">, </span><span class="si">{delay}</span><span class="s1">, </span><span class="si">{count}</span><span class="s1">, AUTO&#39;</span>
                                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bias</span> <span class="o">=</span> <span class="n">bias</span><span class="p">,</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span><span class="p">,</span><span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="p">,</span> <span class="n">delay</span> <span class="o">=</span> <span class="n">delay</span><span class="p">,</span><span class="n">count</span> <span class="o">=</span> <span class="n">count</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;:INIT&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*WAI&quot;</span><span class="p">)</span> <span class="c1">#waits until sweep is finished until executing next command</span>

        <span class="c1">#time.sleep(delay*numSteps*3)</span>
        <span class="n">measuredArray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;:TRAC:DATA? 1, </span><span class="si">{numSteps}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numSteps</span><span class="o">=</span><span class="n">numSteps</span><span class="p">))</span>
        <span class="n">sourceArray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visainstrument</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;:TRAC:DATA? 1, </span><span class="si">{numSteps}</span><span class="s2">, &#39;defbuffer1&#39;, SOUR&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numSteps</span><span class="o">=</span><span class="n">numSteps</span><span class="p">))</span>
        <span class="n">measuredArray</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">measuredArray</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
        <span class="n">sourceArray</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sourceArray</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">sourceArray</span><span class="p">,</span><span class="n">measuredArray</span></div></div>
              

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">KEITH</span> <span class="o">=</span> <span class="n">Keithley_2450_gla</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Keithley_2450_gla&quot;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="s2">&quot;10.22.197.8&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DC current: </span><span class="si">{:.4g}</span><span class="s2">A&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">KEITH</span><span class="o">.</span><span class="n">get_current_dc</span><span class="p">()))</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, QKITgroup.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>